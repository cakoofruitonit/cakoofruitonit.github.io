<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE-edge">
  <meta name="viewpoint" content="width=device-width, inital-scale=1.0">
</head>
<body>
<style>
  .selectText{
    margin-top: 20px;
    width: 100%;
    padding:10px;
    text-align: center;
    font-size: 100px;
    font-weight: bold;
  }
  .pressEnter{
    font-size: 50px;
    width: auto;
    padding:15px;
    text-align: center;
  }
  .selectTable{
    margin:auto;
    margin-top: 20px;
    margin-bottom: 40px;
    width: 100%;
    height: 600px;
    text-align: center;
    border: black;
    
  }
  .enterButtonDiv{
    margin: auto;
    width: 40%;
    padding:10px;
    text-align: center;
  }
  .enter{
    margin-top: 10px;
    margin-bottom: 10px;
    width: 100%;
    height: 100px;
    text-align: center;
    color:rgb(65,105,225);
    font-size: 35px;
    font-weight: bold;
    background-color: rgb(254, 247, 163);
    border-color: blue;
    border-style: none;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .enter:active{
    transform: translateY(10px);
    border: black;
    border-style: outset;
    background-color: rgb(65,105,225);
    color:rgb(254, 247, 163);
  }
  .directions{
    margin-top:100px;
    width: 100%;
    padding:20px;
    text-align: center;
    border:black;
    border-style: outset;
    font-weight:bold; 
    font-size: 95px; 
    transition: all 0.5s ease;
  }
  .path{
    opacity: 0;
    font-weight:normal; 
    font-size: 30px; 
    transition: all 0.5s ease;
  }
  .path.show {
    opacity: 1;
  }
  .next{
    margin: auto;
    width: 50%;
    padding:10px;
    text-align: center;
    padding-bottom: 100px;
  }
  .previous-btn{
    border-color: black;
    border-style: none;
    font-weight: bold;
    background-color: rgb(254, 247, 163);
    color:rgb(65,105,225);
    width:43%;
    height:100px;
    margin-right:20px;
    font-size: 40px;
    text-align: center;
    transition: all 0.25s ease;
  }
  .next-btn{
    border-color: black;
    border-style: none;
    font-weight: bold;
    background-color: rgb(254, 247, 163);
    color:rgb(65,105,225);
    width: 43%;
    height:100px;
    margin-left:40px;
    font-size: 40px;
    text-align: center;
    transition: all 0.25s ease;
  }
  .next-btn:active{
    transform: translateY(10px);
    border-style: outset;
    background-color: rgb(65,105,225);
    color:rgb(254, 247, 163);
  }
  .previous-btn:active{
    transform: translateY(10px);
    border-style: outset;
    background-color: rgb(65,105,225);
    color:rgb(254, 247, 163);
  }
  .startPointText{
    margin: auto;
    margin-top: 17px;
    width: 70%;
    padding:10px;
    text-align: center;
    font-size: 50px;
    color:rgb(65,105,225);
    font-weight:bold;
  }
  .destinationText{
    margin: auto;
    margin-bottom: 100px;
    width: 70%;
    padding: 10px;
    text-align: center;
    font-size: 50px;
    color:rgb(65,105,225);
    font-weight:bold;
  }
  .chooseLocation1{
    width:90%;
    margin-bottom: 10px; 
    font-size: 60px; 
    text-align: center;
    border:black;
    border-style: groove;
  }
  .chooseLocation2{
    width:90%;
    margin-top: 7px;
    margin-bottom: 30px; 
    font-size: 60px; 
    text-align: center;
    border:black;
    border-style: groove;
  }
  .error{
    opacity: 0;
    font-weight:bold; 
    font-size: 50px; 
  }
  .error.show{
    opacity: 1;
  }
  .handicap-btn{
    margin-right: 20px;
    margin-bottom: 8px;
    width: 120px;
    height: 120px;
    text-align: center;
    cursor: pointer;
    border-style: none;
    transition: all 0.25s ease;
  }
  .walking-btn{
    margin-right: 20px;
    margin-bottom: 8px;
    width: 120px;
    height: 120px;
    text-align: center;
    cursor: pointer;
    border-style: none;
    transition: all 0.25s ease;
  }
  .handicap-btn.show{
    margin-right: 20px;
    margin-bottom: 8px;
    width: 120px;
    height: 120px;
    background-color:rgb(155, 179, 250);
    text-align: center;
    cursor: pointer;
    border-style: none;
    transition: all 0.25s ease;
  }
  .walking-btn.show{
    margin-right: 20px;
    margin-bottom: 8px;
    width: 120px;
    height: 120px;
    background-color:rgb(155, 179, 250);
    text-align: center;
    cursor: pointer;
    border-style: none;
    transition: all 0.25s ease;
  }
  .walking-btn:active{
    border-style: outset;
  }
  .line1{
    font-weight:normal; 
    font-size: 45px; 
    transition: all 0.2s ease;
  }
  .line2{
    font-weight:normal; 
    font-size: 45px; 
    transition: all 0.2s ease;
  }
  .line3{
    font-weight:normal; 
    font-size: 45px; 
    transition: all 0.2s ease;
  }
  .line4, .line5, .line6, .line7{
    font-weight:normal; 
    font-size: 45px; 
    transition: all 0.2s ease;
  }
  .line1.bold{
    font-weight:bold; 
    font-size: 60px; 
    transition: all 0.2s ease;
  }
  .line2.bold{
    font-weight:bold; 
    font-size: 60px; 
    transition: all 0.2s ease;
  }
  .line3.bold{
    font-weight:bold; 
    font-size: 60px; 
    transition: all 0.2s ease;
  }
  .line4.bold, .line5.bold, .line6.bold, .line7.bold{
    font-weight:bold; 
    font-size: 60px; 
    transition: all 0.2s ease;
  }
  .option{
    margin-bottom: 50px;
  }
  .fullscreen-div{
    font-size: 60px;
  }
  .fullscreen-text{
    z-index: 3; 
    position: absolute; 
    font-size:3.2vh; 
    text-align: center; 
    width:80%; 
    margin-top:40px; 
    color:white; 
    font-weight: bold; 
    backdrop-filter: blur(3px); 
    border-radius: 16px; 
    margin: 20% 10%; 
    padding:1%; 
    background:rgba(0,0,0,0.5);
  }
  .exit-btn{
    right:0;
    height:7%;
    aspect-ratio: 1/1;
    color:white; 
    z-index: 2; 
    position: absolute; 
    border: none;
    font-size:4vh;
    text-align: center; 
    background:rgba(0,0,0,0.25);
  }
  .inv-pre-btn{
    border: none;
    text-align: left;
    font-size:4vh;
    width:50%;
    height:100%;
    z-index: 1; 
    position: absolute; 
    color:white;
    background:rgba(0,0,0,0.2);
  }
  .inv-next-btn{
    border: none;
    right:0;
    text-align: right;
    font-size:4vh;
    width:50%;
    height:100%;
    z-index: 1; 
    position: absolute; 
    color:white;
    background:rgba(0,0,0,0.2);
  }
  .fullscreen-image{
    z-index:0; 
    width:100%; 
    height:100%;
  }
  .fullscreen-iframe{
    z-index:0; 
    width:100%; 
    height:100%;
    border: 0;
  }
  
</style>
<div class="selectText">Select a starting point and destination:</div>
<div class="selectTable">
  <div2>
    <p class="startPointText">
      Starting Point:
    </p>
    <p2>
      <select class = "chooseLocation1" id="choose-location1" name="list-of-locations1">
        <option name="stop-1" value="SCI-Main">Science Building</option>
        <option name="stop-9" value="BATL-Main">Batmale Hall</option>
        <option name="stop-12" value="CAFE-Main">Cafeteria</option>
        <option name="stop-7" value="CLOUD-Main">Cloud Hall</option>
        <option name="stop-3" value="ART-Main">Creative Arts Building (ART)</option>
        <option name="stop-4" value="ARTX-Main">Creative Arts Extension Building (ARTX)</option>
        <option name="stop-11" value="EHF-Main">Floristy Center</option>
        <option name="stop-2" value="MUB-Main">Multi-use Building (MUB)</option>
        <option name="stop-13" value="JDVL-Main">Judson Village</option>
        <option name="stop-5" value="LIBR-Main">Rosenberg Library (LIBR)</option>
        <option name="stop-6" value="STAD-Main">Rush Stadium</option>
        <option name="stop-8" value="HLTH-Main">Student Health Center</option>
        <option name="stop-10" value="WELL-Main">Wellness Center</option>
        <option value="SCI-150">‚≠ê‚≠ê‚≠êScience Building Room 150‚≠ê‚≠ê‚≠ê</option>
      </select>
    </p2>
  </div2>

  <p3>
    <div3>
      <p2 style="margin-top: 10px"class="destinationText">
        <br>Destination:   
      </p2>
      <select class = "chooseLocation2"id="choose-location2" name="list-of-locations2">
        <option name="stop-9" value="BATL-Main">Batmale Hall</option>
        <option name="stop-12" value="CAFE-Main">Cafeteria</option>
        <option name="stop-7" value="CLOUD-Main">Cloud Hall</option>
        <option name="stop-3" value="ART-Main">Creative Arts Building (ART)</option>
        <option name="stop-4" value="ARTX-Main">Creative Arts Extension Building (ARTX)</option>
        <option name="stop-11" value="EHF-Main">Floristy Center</option>
        <option name="stop-2" value="MUB-Main">Multi-use Building (MUB)</option>
        <option name="stop-13" value="JDVL-Main">Judson Village</option>
        <option name="stop-5" value="LIBR-Main">Rosenberg Library (LIBR)</option>
        <option name="stop-6" value="STAD-Main">Rush Stadium</option>
        <option name="stop-1" value="SCI-Main">Science Building</option>
        <option name="stop-8" value="HLTH-Main">Student Health Center</option>
        <option name="stop-10" value="WELL-Main">Wellness Center</option>
      </select>
    </div3>
    <div id="option" class="option">
      <button id="handicap-btn" class = "handicap-btn" onclick="optionADA()">
        <img width="100" height="100" overflow="hidden" src="images/handicap.webp"/>
      </button>
      <button id="walking-btn" class = "walking-btn" onclick="optionWalkable()">
        <img width="100" height="100" overflow="hidden" src="images/walking.webp"/>
      </button>
    </div>
  </p3>
  <div class="enterButtonDiv">
    <button id="enter" class = "enter" onclick="useDirectionButton()">DIRECTIONS üîç</button>
  </div>
</div>

<div class="directions" id="destination">
  <span class="dir" id="direct"></span>
  
  <div class="path" id="dirText">
    <span class="error" id="error"></span>
    <br>
    <span class="line1" id="textline1"></span>
    <span class="line2" id="textline2"></span>
    <span class="line3" id="textline3"></span>
    <span class="line4" id="textline4"></span>
    <span class="line5" id="textline5"></span>
    <span class="line6" id="textline6"></span>
    <span class="line7" id="textline7"></span>
    <div class ="imageDiv" id="imageDiv">
    </div>
  </div>
</div>


<p style="margin-bottom: 20px;" class = "next">
  <button class="previous-btn" onclick="buttonPrevious()">PREV</button>
  <button class="next-btn" onclick="buttonNext()">NEXT</button>
</p>

<div class="fullscreen-div" id="fullscreen-div">
</div>

<script>
  var routeURL = null;
  var x = document.getElementById("destination");
  var y = document.getElementById("temporaryNext");
  var dir = document.getElementById("direct");
  var directionsImage = document.getElementById("imageDiv");
  var directionsError = document.getElementById("error");
  var directionsTextClass = document.querySelector('.path');
  var lineText1 = document.querySelector('.line4');
  var image = "images/RedTree.jpg";
  var image1 = "images/Synthwave.webp";
  var image2 = "images/DarkDisco.gif";
  var image3 = "images/CyberpunkCity.webp";
  var imageArray = new Array(40);
  var counter = 0;
  var max = 0;
  var notInErrorScreen = true;
  var selectElement = document.querySelector("#choose-location1");
  var selectElement1 = document.querySelector("#choose-location2");
  var inStartingScreen = true;
  var selectedADA = false;
  var selectedWalkable = true;
  optionWalkable();
  openFullScreenHandler("imageDiv", "fullscreen-div");

  function optionADA(){
    selectedADA = true;
    selectedWalkable = false;
    document.querySelector('.walking-btn').classList.remove('show');
    document.querySelector('.handicap-btn').classList.add('show');
  }

  function optionWalkable(){
    selectedADA = false;
    selectedWalkable = true;
    document.querySelector('.handicap-btn').classList.remove('show');
    document.querySelector('.walking-btn').classList.add('show');
  }
  
  function useDirectionButton(){
    for(var i = 1; i <= max; i++){
      document.getElementById("textline" + (i)).innerHTML = null;
    }
    dir.innerHTML = "Route:";
    const startingPoint = selectElement.options[selectElement.selectedIndex].value;
    const destination = selectElement1.options[selectElement1.selectedIndex].value;
    /*
    * Starting image initialized here
    */
    var source = "images/StartingPoint" + determineRoute(startingPoint, destination) + ".jpg";
    //directionsImage.innerHTML = "<br>" + '<img width="800" height="533" overflow="hidden" src=' + source +' />';
    fetch("google_maps_routes.json")
      .then(response => response.json())
      .then(data => {
        for(var j = 0; j < data.length; j++){
          console.log(determineRoute(startingPoint, destination) + " " + data[j].routeID);
          if(determineRoute(startingPoint, destination).match(data[j].routeID)){
            if(selectedADA){
              routeURL = data[j].urlADA;
            } else {
              routeURL = data[j].urlWalking;
            }
            break;
          } else {
            routeURL = null;
          }
        }
        if(routeURL != null){
          directionsImage.innerHTML = '<iframe width="100%" height="700px" src=' + routeURL +'></iframe>';
        } else {
          directionsImage.innerHTML = '<br><span style="font-size:60px">To be added...</span>';
          directionsImage.innerHTML += "<br>" + '<img width="800" height="533" overflow="hidden" src="images/CyberpunkCity.gif" />';
        }
      });
    directionsTextClass.classList.add('show');
    inStartingScreen = true;
    if(!notInErrorScreen){
      directionsError.classList.remove('show');
      notInErrorScreen = true;
      document.getElementById("error").innerHTML = null;
    }
    if(startingPoint.match(destination)){
      directionsError.innerHTML = '<span style="color:rgb(255,99,71); font-size:70px;">Error:</span><br>The starting point and destination cannot be the same';
      directionsError.classList.add('show');
      directionsTextClass.classList.add('show');
      for(var i = 1; i <= max; i++){
        document.getElementById("textline" + (i)).innerHTML = null;
      }
      notInErrorScreen = false;
      max = 0;
      setTimeout(()=>{
        directionsImage.innerHTML = null;
      }, 100);
    }
    counter = 0;
  }
  function useNextButton(startingPoint, destination){
    if(startingPoint != destination){
      dir.innerHTML = "Directions: ";
      var string = "";
      var leftOrRight = "";
      var elevationChange = null;
      var routeIndex = -1;
      var jsonFileData = null;
      fetch("routes_file.json")
      .then(response => response.json())
      .then(data => {
        for(var j = 0; j < data.Routes.length; j++){
          if(determineRoute(startingPoint, destination).match(data.Routes[j].RouteID)){
            routeIndex = j;
          }
        }
        const route = data.Routes[routeIndex].Route;
        const routeID = data.Routes[routeIndex].RouteID;
        
        /*
        * Image only displays if directions exists in the json file
        */

        for(var i = 0; i < route.length; i++){
          var textline = document.getElementById("textline" + (i+1));
          
          /*
          * Checks whether the client selected ADA or AbleBodied
          * If the path is fine for ADA and is the shortest path
          * That is what the "FOR ALL" key is
          */

          if(route[i].ForAll != null){
            textline.innerHTML = route[i].ForAll + "<br>";
            if(route[i].ImageForAll != null){
              imageArray[i] = "images/" + route[i].ImageForAll;
            }
          } else {
            if(selectedADA && route[i].ADA != null){
              textline.innerHTML = route[i].ADA + "<br>";
              if(route[i].ImageADA != null){
                imageArray[i] = "images/" + route[i].ImageADA;
              }
            } else if(selectedWalkable && route[i].AbleBodied != null){
              textline.innerHTML = route[i].AbleBodied + "<br>";
              if(route[i].ImageAbleBodied != null){
                imageArray[i] = "images/" + route[i].ImageAbleBodied;
              } 
            } else {
              textline.innerHTML = null;
              imageArray[i] = "images/" + "CyberpunkCity.gif";
            }
          }
          console.log(i + ") ran");
          if(route[i].isEnd == true){
            textline.innerHTML += "<br>" + route[i].EntranceType;
          }
        }

        /*
        * Initializes the first image of the array
        */

        directionsImage.innerHTML = "<br>" + '<img width="800" height="533" overflow="hidden" src=' + imageArray[0] +' />';
        max = route.length;
      });
      document.getElementById("error").innerHTML = null;
      directionsTextClass.classList.add('show');
      directionsError.classList.remove('show');
      counter = 1;
      for(var i = 1; i <= max; i++){
        document.querySelector(".line" + i).classList.remove('bold');
      }
      document.querySelector(".line" + 1).classList.add('bold');
      notInErrorScreen = true;
    } else {
      directionsError.innerHTML = '<span id="error-msg" style="color:rgb(255,99,71); font-size:70px;">Error:</span><br>The starting point and destination cannot be the same';
      directionsError.classList.add('show');
      directionsTextClass.classList.add('show');
      for(var i = 1; i <= max; i++){
        document.getElementById("textline" + (i)).innerHTML = null;
      }
      counter = 0;
      notInErrorScreen = false;
      max = 0;
      if(directionsImage != null){
        directionsImage.innerHTML = null;
      }
    }
  }

  function determineRoute(startingPoint, destination){
    let s1 = startingPoint.split("-");
    let s2 = destination.split("-");
    return s1[0] + "to" + s2[0];
  }

  function buttonNext(){
    const startingPoint = selectElement.options[selectElement.selectedIndex].value;
    const destination = selectElement1.options[selectElement1.selectedIndex].value;
    if(counter != max && notInErrorScreen && !inStartingScreen){
      counter = counter + 1;
      document.querySelector(".line" + (counter - 1)).classList.remove('bold');
      document.querySelector(".line" + counter).classList.add('bold');
      directionsImage.innerHTML = "<br>" + '<img width="800" height="533" overflow="hidden" src=' + imageArray[counter-1] +' />';
      inStartingScreen = false;
    } else if(inStartingScreen){
      useNextButton(startingPoint, destination);
      inStartingScreen = false;
    }
  }

  function buttonPrevious(){
    if(counter != 1 && notInErrorScreen){
      counter = counter - 1;
      document.querySelector(".line" + (counter + 1)).classList.remove('bold');
      document.querySelector(".line" + counter).classList.add('bold');
      directionsImage.innerHTML = "<br>" + '<img width="800" height="533" overflow="hidden" src=' + imageArray[counter-1] +' />';
    } else if(counter == 1){
      inStartingScreen = true;
      dir.innerHTML = "Starting Point: ";
      for(var i = 1; i <= max; i++){
        document.getElementById("textline" + (i)).innerHTML = null;
      }
      useDirectionButton();
    }
  }
  
  function openFullScreenHandler(eventID, id){
    var element = document.getElementById(eventID);
    var element1 = document.getElementById(id);
    element.addEventListener("touchstart", ()=> {
      if(document.fullscreenElement){
        document.exitFullscreen();
      } else {
        /*
        *  max-width: 100%;
        *  height: auto;
        *  width: auto\9; /* ie8 *\
        */
        fullscreenUIHandler(true, 0, true, false);
        element1.requestFullscreen().catch(e => {
          console.log(e);
        })
      }
    });
  }

  function exitFullscreenMode(){
    if(document.fullscreenElement){
      document.exitFullscreen();
      document.getElementById("fullscreen-div").innerHTML = null;
    }
  }

  function preInFullscreenMode(){
    if(document.fullscreenElement){
      if(counter > 1){
        document.getElementById("fullscreen-text").innerHTML = document.getElementById("textline" + (counter - 1)).innerHTML;
        document.getElementById("fullscreen-image").src = imageArray[counter-2];
      } else if(counter == 1){
        const startingPoint = selectElement.options[selectElement.selectedIndex].value;
        const destination = selectElement1.options[selectElement1.selectedIndex].value;
        fullscreenUIHandler(false, 100, false, true);
      }
      buttonPrevious();
    }
  }

  function nextInFullscreenMode(){
    if(document.fullscreenElement){
      if(counter < max && counter != 0){
        buttonNext();
        document.getElementById("fullscreen-text").innerHTML = document.getElementById("textline" + (counter)).innerHTML;
        document.getElementById("fullscreen-image").src = imageArray[counter - 1];
      } else if(counter == 0){
        buttonNext();
        fullscreenUIHandler(true, 100, true, false);
      }
    }
  }

  function fullscreenUIHandler(needText, timer, needImage, needGoogleMapsIframe){
    const element1 = document.getElementById("fullscreen-div");
    if(needText && timer <= 0){
      element1.innerHTML = '<div id="fullscreen-text" class="fullscreen-text">' + document.getElementById("textline" + counter).innerHTML + '</div>';
    } else if(timer > 0 && needText){
      setTimeout(()=>{
        element1.innerHTML = '<div id="fullscreen-text" class="fullscreen-text">' + document.getElementById("textline" + counter).innerHTML + '</div>';
      },timer);
    } else {
      element1.innerHTML = null;
    }
    if(timer > 0){
      setTimeout(()=>{
        element1.innerHTML += '<button id="exit-btn" class = "exit-btn" onclick="exitFullscreenMode()">X</button>';
        element1.innerHTML += '<button id="inv-pre-btn" class = "inv-pre-btn" onclick="preInFullscreenMode()">PREV</button>';
        element1.innerHTML += '<button id="inv-next-btn" class = "inv-next-btn" onclick="nextInFullscreenMode()">NEXT</button>';
        if(needImage){
          element1.innerHTML += '<img id="fullscreen-image" class="fullscreen-image" src=' + imageArray[counter-1] +' />';
        }
        if(needGoogleMapsIframe){
          if(routeURL != null){
            element1.innerHTML += '<iframe id="fullscreen-iframe" class="fullscreen-iframe" src=' + routeURL + '></iframe>';
          } else {
            element1.innerHTML += '<img id="fullscreen-image" class="fullscreen-image" src="images/CyberpunkCity.gif" />';
          }
        }
      },timer);
    } else {
      element1.innerHTML += '<button id="exit-btn" class = "exit-btn" onclick="exitFullscreenMode()">X</button>';
      element1.innerHTML += '<button id="inv-pre-btn" class = "inv-pre-btn" onclick="preInFullscreenMode()">PREV</button>';
      element1.innerHTML += '<button id="inv-next-btn" class = "inv-next-btn" onclick="nextInFullscreenMode()">NEXT</button>';
      if(needImage){
        element1.innerHTML += '<img id="fullscreen-image" class="fullscreen-image" src=' + imageArray[counter-1] +' />';
      }
      if(needGoogleMapsIframe){
        if(routeURL != null){
          element1.innerHTML += '<iframe id="fullscreen-iframe" class="fullscreen-iframe" src=' + routeURL + '></iframe>';
        } else {
          element1.innerHTML += '<img id="fullscreen-image" class="fullscreen-image" overflow="hidden" src="images/CyberpunkCity.gif" />';
        }
      }
    }
  }
  </script>

  </body>
</html>
